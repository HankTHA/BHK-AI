<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>房产客户画像指标体系 思维导图</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&family=Bebas+Neue&display=swap');

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: #080c18;
    font-family: 'Noto Sans SC', sans-serif;
    overflow: hidden;
    width: 100vw;
    height: 100vh;
  }

  canvas {
    position: absolute;
    top:0; left:0;
    pointer-events: none;
    z-index: 0;
  }

  #header {
    position: absolute;
    top: 18px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    z-index: 100;
    pointer-events: none;
  }
  #header h1 {
    font-family: 'Bebas Neue', 'Noto Sans SC', sans-serif;
    font-size: 26px;
    letter-spacing: 8px;
    color: #fff;
    text-shadow: 0 0 30px rgba(180,200,255,0.5);
  }
  #header p {
    font-size: 11px;
    color: rgba(255,255,255,0.35);
    letter-spacing: 4px;
    margin-top: 3px;
  }

  #mindmap {
    position: absolute;
    top:0; left:0;
    width:100%; height:100%;
    z-index: 10;
  }

  .node {
    position: absolute;
    transform: translate(-50%, -50%);
    cursor: default;
    z-index: 20;
    animation: popIn 0.5s cubic-bezier(0.34,1.56,0.64,1) both;
  }
  .node:hover { z-index: 50; }

  @keyframes popIn {
    from { opacity:0; transform: translate(-50%,-50%) scale(0.3); }
    to   { opacity:1; transform: translate(-50%,-50%) scale(1); }
  }

  .n-center {
    width: 108px; height: 108px;
    border-radius: 50%;
    background: radial-gradient(circle at 38% 32%, #e8f0ff, #a0b8f8);
    display: flex; align-items: center; justify-content: center;
    text-align: center;
    font-size: 12px; font-weight: 800; color: #0a0e1a;
    line-height: 1.4;
    box-shadow: 0 0 0 6px rgba(140,170,255,0.15), 0 0 40px rgba(120,160,255,0.5);
    animation: glow 3s ease-in-out infinite;
  }
  @keyframes glow {
    0%,100% { box-shadow: 0 0 0 6px rgba(140,170,255,0.15), 0 0 40px rgba(120,160,255,0.4); }
    50%      { box-shadow: 0 0 0 10px rgba(140,170,255,0.25), 0 0 70px rgba(120,160,255,0.7); }
  }

  .n-l1 {
    padding: 8px 14px;
    border-radius: 30px;
    font-size: 12px; font-weight: 800;
    color: #0a0e1a;
    text-align: center;
    white-space: nowrap;
    box-shadow: 0 4px 16px rgba(0,0,0,0.5);
    transition: transform 0.2s;
  }
  .n-l1:hover { transform: scale(1.1) !important; }

  .n-l2 {
    padding: 5px 11px;
    border-radius: 16px;
    font-size: 11px; font-weight: 600;
    color: #fff;
    text-align: center;
    white-space: nowrap;
    border: 1px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(6px);
    transition: transform 0.2s;
  }
  .n-l2:hover { transform: scale(1.1) !important; }

  .n-l3 {
    padding: 3px 9px;
    border-radius: 10px;
    font-size: 10px; font-weight: 400;
    text-align: center;
    white-space: nowrap;
    border: 1px solid rgba(255,255,255,0.12);
    transition: transform 0.2s;
  }
  .n-l3:hover { transform: scale(1.12) !important; }

  .legend {
    position: absolute;
    bottom: 16px;
    left: 50%;
    transform: translateX(-50%);
    display: flex; gap: 14px;
    z-index: 100;
    flex-wrap: wrap; justify-content: center;
    pointer-events: none;
  }
  .li { display:flex; align-items:center; gap:5px; font-size:10px; color:rgba(255,255,255,0.5); }
  .ld { width:9px; height:9px; border-radius:50%; flex-shrink:0; }

  #tip {
    position: fixed;
    background: rgba(8,12,24,0.96);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 10px;
    padding: 8px 12px;
    font-size: 11px; color: rgba(255,255,255,0.8);
    pointer-events: none;
    z-index: 999;
    max-width: 180px;
    display: none;
    line-height: 1.6;
    backdrop-filter: blur(12px);
  }
</style>
</head>
<body>

<canvas id="cv"></canvas>

<div id="header">
  <h1>客户画像指标体系</h1>
  <p>Customer Profiling Framework · Real Estate</p>
</div>

<div id="mindmap"></div>
<div class="legend" id="legend"></div>
<div id="tip"></div>

<script>
const CATS = [
  { label:'客户\n基本属性', color:'#FF6B6B',
    children:[
      { label:'身份属性', detail:'国籍 / 户籍 / 签证 / 首次购房',   leaves:['国籍','户籍','签证状态','首次购房'] },
      { label:'家庭结构', detail:'婚姻 / 人口 / 儿童 / 老人',       leaves:['婚姻状况','家庭人数','有儿童','有老人'] },
      { label:'职业收入', detail:'职业类型 / 行业 / 收入范围',       leaves:['职业类型','行业','收入范围','稳定性'] },
      { label:'购房资格', detail:'贷款资格 / 外国人购房资格',        leaves:['贷款资格','可贷比例','外国人资格'] },
    ]
  },
  { label:'预算\n能力', color:'#FFD93D',
    children:[
      { label:'总预算',   detail:'最低 / 最高 / 理想预算',          leaves:['最低预算','最高预算','理想预算'] },
      { label:'首付能力', detail:'首付比例 / 可用现金',              leaves:['首付比例','可用现金','依赖贷款'] },
      { label:'月供承受', detail:'最大可承受月供 / 收入月供比',      leaves:['最大月供','收入月供比'] },
      { label:'支付方式', detail:'全款 / 贷款 / 分期',               leaves:['全款','贷款','分期'] },
    ]
  },
  { label:'房源属性\n需求', color:'#6BCB77',
    children:[
      { label:'房屋类型', detail:'Condo / House / Townhouse',        leaves:['Condo','House','Townhouse','商业物业'] },
      { label:'面积户型', detail:'面积范围 / 卧室 / 卫生间',         leaves:['最小面积','最大面积','卧室数','卫生间数'] },
      { label:'楼层朝向', detail:'高/中/低层 / 朝向 / 景观',         leaves:['楼层偏好','朝向需求','景观要求'] },
      { label:'装修状态', detail:'精装 / 简装 / 毛坯',               leaves:['精装','简装','毛坯'] },
    ]
  },
  { label:'区位\n需求', color:'#4D96FF',
    children:[
      { label:'目标城市', detail:'曼谷 / 芭提雅 / 普吉',            leaves:['曼谷','芭提雅','普吉'] },
      { label:'目标区域', detail:'Sukhumvit / Rama9 / Silom 等',     leaves:['Sukhumvit','Rama9','Asok','Silom'] },
      { label:'交通需求', detail:'BTS / MRT 距离要求',               leaves:['BTS距离','MRT距离'] },
      { label:'生活配套', detail:'工作距离 / 学区',                  leaves:['通勤时间','学区需求'] },
    ]
  },
  { label:'购房\n动机', color:'#C77DFF',
    children:[
      { label:'自住需求', detail:'当前租房 / 换房 / 首套',           leaves:['当前租房','换房','首套房'] },
      { label:'投资需求', detail:'租金回报率 / 增值空间',            leaves:['租金回报','增值空间'] },
      { label:'子女教育', detail:'国际学校 / 学区配套',              leaves:['国际学校','学区配套'] },
      { label:'移民居住', detail:'签证需求 / 长期居住',              leaves:['签证需求','长期居住'] },
    ]
  },
  { label:'购房\n紧迫度', color:'#FF9A3C',
    children:[
      { label:'时间计划', detail:'立即 / 短期 / 中期 / 长期',        leaves:['0-1个月','1-3个月','3-6个月','6个月+'] },
      { label:'决策阶段', detail:'浏览→意向→看房→成交',             leaves:['浏览','意向','看房','成交'] },
      { label:'看房行为', detail:'看房次数 / 收藏 / 咨询',           leaves:['看房次数','收藏数','咨询次数'] },
    ]
  },
  { label:'偏好\n标签', color:'#FF6EC7',
    children:[
      { label:'社区偏好', detail:'品牌开发商 / 新盘 / 二手',         leaves:['品牌开发商','新盘','二手房'] },
      { label:'配套偏好', detail:'靠近商场 / 地铁 / 公园',           leaves:['靠近商场','靠近地铁','靠近公园'] },
      { label:'房源特征', detail:'高层 / 景观房',                    leaves:['高层','景观房'] },
    ]
  }
];

// ── helpers ──────────────────────────────────────────────────────────
function rgba(hex, a) {
  const r=parseInt(hex.slice(1,3),16), g=parseInt(hex.slice(3,5),16), b=parseInt(hex.slice(5,7),16);
  return `rgba(${r},${g},${b},${a})`;
}
function polar(cx, cy, r, deg) {
  const rad = deg * Math.PI / 180;
  return { x: cx + r*Math.cos(rad), y: cy + r*Math.sin(rad) };
}

// ── layout ───────────────────────────────────────────────────────────
// Divide 360° proportionally by total leaf count per category.
// L2 nodes split their category arc proportionally by their leaf count.
// L3 leaves are placed uniformly within the L2 sub-arc with a small inset.
// This guarantees no two leaves share the same angle.

function computeLayout(W, H) {
  const cx = W/2, cy = H/2;
  const scale = Math.min(W, H);
  const R1 = scale * 0.165;
  const R2 = scale * 0.295;
  const R3 = scale * 0.42;

  const totalLeaves = CATS.reduce((s,c)=>s+c.children.reduce((ss,ch)=>ss+ch.leaves.length,0),0);

  let cursor = -90;
  const layout = [];

  CATS.forEach((cat, ci) => {
    const catLeafCount = cat.children.reduce((s,ch)=>s+ch.leaves.length,0);
    const catArc = (catLeafCount / totalLeaves) * 360;
    const catStart = cursor;
    const catEnd   = cursor + catArc;
    const catMid   = (catStart + catEnd) / 2;
    cursor = catEnd;

    const l1pos = polar(cx, cy, R1, catMid);

    let l2cursor = catStart;
    const children = cat.children.map((ch, chi) => {
      const chArc   = (ch.leaves.length / catLeafCount) * catArc;
      const chStart = l2cursor;
      const chEnd   = l2cursor + chArc;
      const chMid   = (chStart + chEnd) / 2;
      l2cursor = chEnd;

      const l2pos = polar(cx, cy, R2, chMid);

      const n = ch.leaves.length;
      const inset = n > 1 ? chArc * 0.12 : 0;
      const leaves = ch.leaves.map((leaf, li) => {
        const leafAngle = n === 1 ? chMid
          : (chStart + inset) + (li / (n-1)) * (chArc - 2*inset);
        return { leaf, pos: polar(cx, cy, R3, leafAngle) };
      });

      return { ch, l2pos, leaves };
    });

    layout.push({ cat, l1pos, children, ci });
  });

  return { cx, cy, R1, R2, R3, layout };
}

// ── canvas ───────────────────────────────────────────────────────────
const cv  = document.getElementById('cv');
const ctx = cv.getContext('2d');

function drawCanvas({ cx, cy, layout }) {
  ctx.clearRect(0, 0, cv.width, cv.height);

  // faint grid
  ctx.save();
  ctx.strokeStyle = 'rgba(255,255,255,0.022)';
  ctx.lineWidth = 1;
  for(let x=0;x<cv.width;x+=60){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,cv.height);ctx.stroke();}
  for(let y=0;y<cv.height;y+=60){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(cv.width,y);ctx.stroke();}
  ctx.restore();

  layout.forEach(({ cat, l1pos, children }) => {
    const col = cat.color;
    seg(cx, cy, l1pos.x, l1pos.y, rgba(col,0.55), 2.5, []);

    children.forEach(({ l2pos, leaves }) => {
      seg(l1pos.x, l1pos.y, l2pos.x, l2pos.y, rgba(col,0.35), 1.5, [4,4]);
      leaves.forEach(({ pos }) => {
        seg(l2pos.x, l2pos.y, pos.x, pos.y, rgba(col,0.2), 1, [2,5]);
      });
    });
  });
}

function seg(x1,y1,x2,y2,color,w,dash){
  ctx.save();
  ctx.strokeStyle=color; ctx.lineWidth=w; ctx.lineCap='round';
  ctx.setLineDash(dash);
  ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
  ctx.restore();
}

// ── DOM ──────────────────────────────────────────────────────────────
const mm  = document.getElementById('mindmap');
const tip = document.getElementById('tip');

function buildDOM({ cx, cy, layout }) {
  mm.innerHTML = '';

  // center
  const cEl = mkNode(cx, cy, 0);
  cEl.innerHTML = `<div class="n-center">客户画像<br>指标体系</div>`;
  mm.appendChild(cEl);

  layout.forEach(({ cat, l1pos, children, ci }) => {
    const col = cat.color;

    const l1El = mkNode(l1pos.x, l1pos.y, ci*0.07+0.15);
    l1El.innerHTML = `<div class="n-l1" style="background:${col}">${cat.label.replace('\n','<br>')}</div>`;
    mm.appendChild(l1El);

    children.forEach(({ ch, l2pos, leaves }, chi) => {
      const l2El = mkNode(l2pos.x, l2pos.y, ci*0.07+chi*0.04+0.3);
      l2El.innerHTML = `<div class="n-l2" style="background:${rgba(col,0.22)};border-color:${rgba(col,0.5)}">${ch.label}</div>`;
      addTip(l2El, `<strong style="color:${col}">${ch.label}</strong><br>${ch.detail}`);
      mm.appendChild(l2El);

      leaves.forEach(({ leaf, pos }, li) => {
        const l3El = mkNode(pos.x, pos.y, ci*0.05+chi*0.03+li*0.015+0.5);
        l3El.innerHTML = `<div class="n-l3" style="background:${rgba(col,0.1)};border-color:${rgba(col,0.3)};color:${col}">${leaf}</div>`;
        mm.appendChild(l3El);
      });
    });
  });
}

function mkNode(x, y, delay) {
  const el = document.createElement('div');
  el.className = 'node';
  el.style.left = x+'px'; el.style.top = y+'px';
  el.style.animationDelay = delay+'s';
  return el;
}

function addTip(el, html) {
  el.style.cursor = 'pointer';
  el.addEventListener('mouseenter', () => { tip.style.display='block'; tip.innerHTML=html; });
  el.addEventListener('mousemove',  e  => { tip.style.left=(e.clientX+14)+'px'; tip.style.top=(e.clientY-10)+'px'; });
  el.addEventListener('mouseleave', () => { tip.style.display='none'; });
}

// ── legend ───────────────────────────────────────────────────────────
const lg = document.getElementById('legend');
CATS.forEach(c => {
  const d = document.createElement('div'); d.className='li';
  d.innerHTML=`<div class="ld" style="background:${c.color}"></div>${c.label.replace('\n','')}`;
  lg.appendChild(d);
});

// ── render ───────────────────────────────────────────────────────────
function render() {
  cv.width  = window.innerWidth;
  cv.height = window.innerHeight;
  const lyt = computeLayout(cv.width, cv.height);
  drawCanvas(lyt);
  buildDOM(lyt);
}

window.addEventListener('resize', render);
render();
</script>
</body>
</html>
